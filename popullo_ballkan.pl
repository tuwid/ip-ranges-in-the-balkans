#/usr/bin/perl

use DBD::mysql;
use NetAddr::IP;
my $dbh = DBI->connect("DBI:mysql:$db", "$user", "$pw") || die "Snuk: $DBI::errstr";

$db = "";
$user = "root";
$pw = "";


$data_mk = '5.32.176.0/21
31.3.88.0/21
31.7.168.0/21
31.11.64.0/18
31.12.16.0/20
37.25.80.0/21
37.26.96.0/21
46.29.168.0/21
46.217.0.0/16
62.162.0.0/16
62.220.192.0/19
77.28.0.0/15
78.40.0.0/21
78.157.0.0/19
79.99.56.0/21
79.125.128.0/17
79.126.128.0/17
79.141.112.0/20
80.77.144.0/20
85.30.64.0/18
88.85.96.0/19
89.31.152.0/21
89.185.192.0/19
89.205.0.0/17
91.198.59.0/24
91.199.231.0/24
91.212.122.0/24
91.220.95.0/24
91.226.20.0/23
91.230.219.0/24
92.53.0.0/18
92.55.64.0/18
93.95.64.0/21
94.100.96.0/20
95.86.0.0/18
95.128.184.0/21
95.156.0.0/18
95.180.128.0/17
109.69.40.0/21
141.136.8.0/21
146.255.64.0/19
151.236.240.0/20
164.40.248.0/21
178.249.112.0/21
185.2.188.0/22
185.5.4.0/22
185.6.20.0/22
188.44.0.0/19
193.104.33.0/24
193.203.1.0/24
193.203.4.0/24
193.203.224.0/24
194.61.58.0/24
194.149.128.0/19
195.26.128.0/19
195.88.122.0/23
195.189.206.0/23
195.200.246.0/23
212.13.64.0/19
212.110.64.0/19
212.120.0.0/19
212.158.176.0/20
213.135.160.0/19
217.16.64.0/19
217.196.192.0/20';

$data_cr = '31.204.192.0/18
37.0.64.0/21
37.122.160.0/19
37.221.176.0/21
46.33.192.0/19
46.161.64.0/18
62.4.32.0/19
77.222.0.0/19
78.155.32.0/19
79.140.144.0/20
79.143.96.0/20
85.94.96.0/19
89.188.32.0/19
89.207.192.0/21
91.217.138.0/24
91.220.187.0/24
94.102.224.0/20
95.155.0.0/18
109.72.96.0/20
109.228.64.0/18
176.57.88.0/21
178.175.0.0/17
185.12.40.0/22
195.66.160.0/19
195.140.164.0/22
195.242.169.0/24
213.133.0.0/19
213.149.96.0/19
213.163.96.0/19';

$data_srb = '5.22.160.0/19
5.57.72.0/21
5.134.104.0/21
5.172.32.0/21
5.206.232.0/21
24.135.0.0/16
37.18.184.0/21
37.19.104.0/21
37.35.8.0/21
37.35.64.0/21
37.77.168.0/21
37.220.64.0/20
46.16.104.0/21
46.17.120.0/21
46.17.144.0/21
46.22.144.0/20
46.40.0.0/18
46.151.120.0/21
46.151.128.0/21
46.174.96.0/21
46.235.96.0/21
46.240.128.0/17
62.108.96.0/19
62.193.128.0/19
62.240.0.0/19
77.46.128.0/17
77.74.248.0/21
77.105.0.0/18
77.243.16.0/20
77.247.200.0/21
77.247.248.0/21
78.24.104.0/21
78.30.128.0/18
78.109.96.0/20
79.101.0.0/16
79.110.144.0/20
79.175.64.0/18
80.70.240.0/20
80.74.160.0/20
80.93.224.0/19
80.240.144.0/20
81.18.48.0/20
81.24.240.0/21
82.117.192.0/19
82.208.192.0/18
83.136.176.0/21
84.22.32.0/19
85.202.112.0/20
85.222.128.0/17
87.116.128.0/18
87.237.200.0/21
87.238.208.0/21
87.250.32.0/19
88.150.128.0/17
89.23.64.0/19
89.110.192.0/18
89.216.0.0/16
91.102.168.0/21
91.102.224.0/21
91.103.8.0/21
91.143.208.0/20
91.148.64.0/18
91.150.64.0/18
91.185.96.0/19
91.187.128.0/19
91.193.24.0/22
91.193.75.0/24
91.194.82.0/23
91.194.216.0/23
91.195.38.0/23
91.195.176.0/23
91.199.17.0/24
91.200.192.0/22
91.201.136.0/22
91.207.62.0/23
91.208.89.0/24
91.212.15.0/24
91.212.69.0/24
91.217.14.0/23
91.218.172.0/22
91.221.134.0/23
91.221.216.0/23
91.222.4.0/22
91.223.162.0/24
91.224.250.0/23
91.226.240.0/22
91.228.16.0/22
91.228.20.0/23
91.228.252.0/23
91.228.254.0/24
91.231.88.0/24
91.231.158.0/23
91.232.106.0/23
91.232.200.0/23
91.232.236.0/23
91.233.24.0/24
91.234.132.0/22
91.234.190.0/23
91.238.6.0/23
91.238.61.0/24
91.239.151.0/24
91.240.6.0/23
91.240.40.0/22
91.243.78.0/23
91.243.123.0/24
91.245.214.0/24
92.42.248.0/21
92.60.224.0/20
92.244.128.0/19
93.86.0.0/15
93.92.248.0/21
93.93.192.0/21
93.184.80.0/20
93.186.64.0/20
93.187.240.0/21
93.190.160.0/21
94.100.48.0/20
94.154.104.0/21
94.189.128.0/17
94.228.224.0/20
94.229.112.0/20
94.230.176.0/20
94.247.200.0/21
95.85.128.0/18
95.140.112.0/20
95.168.64.0/19
95.180.0.0/17
109.72.48.0/20
109.92.0.0/15
109.94.96.0/19
109.94.224.0/20
109.106.224.0/19
109.109.192.0/20
109.111.224.0/19
109.121.0.0/17
109.122.64.0/18
109.198.0.0/19
109.206.96.0/19
109.207.32.0/20
109.233.184.0/21
109.235.96.0/21
109.245.0.0/16
130.180.224.0/19
147.91.0.0/16
160.99.0.0/16
176.67.192.0/19
176.103.216.0/21
176.104.104.0/21
176.106.120.0/21
176.108.32.0/20
176.109.136.0/21
176.123.208.0/21
176.221.72.0/21
178.17.16.0/20
178.20.160.0/21
178.20.200.0/21
178.22.216.0/21
178.79.0.0/18
178.148.0.0/15
178.212.88.0/21
178.217.8.0/21
178.219.0.0/20
178.220.0.0/14
178.237.208.0/20
178.250.136.0/21
178.253.192.0/18
178.254.128.0/18
185.6.188.0/22
185.10.140.0/22
185.10.204.0/22
185.13.8.0/22
188.2.0.0/16
188.93.120.0/21
188.95.176.0/21
188.120.96.0/19
188.246.32.0/19
188.255.128.0/17
192.162.52.0/22
193.30.248.0/22
193.34.64.0/22
193.34.142.0/23
193.53.106.0/24
193.104.68.0/24
193.105.163.0/24
193.107.4.0/22
193.203.2.0/23
193.203.6.0/23
193.203.18.0/23
193.203.22.0/24
193.203.24.0/22
193.203.28.0/23
193.243.168.0/22
194.24.248.0/23
194.28.128.0/22
194.32.150.0/24
194.54.180.0/22
194.79.40.0/22
194.106.160.0/19
194.110.216.0/24
194.145.153.0/24
194.247.39.0/24
194.247.192.0/19
195.46.52.0/22
195.64.170.0/23
195.88.12.0/23
195.88.216.0/23
195.149.192.0/22
195.170.183.0/24
195.178.32.0/19
195.182.214.0/23
195.222.96.0/22
195.242.76.0/23
195.250.96.0/19
195.252.64.0/18
212.57.40.0/21
212.62.32.0/19
212.69.0.0/19
212.102.128.0/19
212.124.160.0/19
212.178.224.0/19
212.200.0.0/16
213.137.96.0/19
213.184.96.0/19
213.198.192.0/18
213.240.0.0/18
213.244.192.0/18
217.16.128.0/20
217.17.96.0/20
217.24.16.0/20
217.26.64.0/20
217.65.192.0/20
217.119.240.0/20
217.169.208.0/20';


#popullo_ballkan($data_mk,"fyrom","MK");
#popullo_ballkan($data_cr,"montenegro","ME");
#popullo_ballkan($data_gr,"greku","GR");
popullo_ballkan($data_srb,"serbi","RS");

sub popullo_ballkan{

$user = "root";
$pw = "";


my $data = shift;
my $db = shift;
my $isp_code = shift;

@cidr = split(/\n/,$data); 



for my $cidr( @cidr ) {
    print "$cidr\n";
    my $n = NetAddr::IP->new( $cidr );
    for my $ip( @{$n->hostenumref} ) {
        print "\t", $ip->addr, "\n";

			#updatojme tabelen e te dhenave baze
                my $sql = "INSERT INTO $db.`ipal` (`ip`,`last_ch`,`locked`,`hostname`,`isp`,`qyteti`,`os`,`status`,`shteti`) VALUES(?,?,?,?,?,?,?,?,?)"; #
                        my $sth = $dbh->prepare($sql);
                        if (!$sth){
                                #logs("Probleme me tabelen caricati");
                                #dergo_mail("Probleme me tabelen caricati");
                                die "Probleme me tabelen\n";
                                }
                        else {
                          $sth->execute($ip->addr,"19700101","0","NA","1","NA","NA","NA","$isp_code");
                        }
                        
        #push (@ip1,$ip->addr);
    }
}

print "U kry bac!\n";
#rint rscalar(@ip1);

#exit(1);
}
$dbh->disconnect;
